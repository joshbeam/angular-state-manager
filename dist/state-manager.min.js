!function(t){"use strict";t.module("stateManager",[])}(angular),function(t){"use strict";function e(){function e(t){return new i(t)}function n(){return g}function i(t){return this.states=[],this.states.count=function(){return this.length},this.$scope={},this.$name=t,g.push(this),function(t){return t?this.states.filter(function(e){return e.$name===t})[0]:this}.bind(this)}function s(t){this.$name=t.name,this.$start=t.start||null,this.$stop=t.stop||null,this.$done=t.done||null,this.$subject=t.subject||{},this.$active=!1,this.$model="",this.$exclusiveOf=[],this.$children=[],this.$auxillary=t.auxillary||null,this.$scope={}}function o(t){var e;return t&&t.constructor===Function&&(e=t(this.$name,this.states)),this.states.push(new s(e)),this}function r(){return this.states}function c(e){function n(e){return e?(this.$scope=e,void t.forEach(this.states,function(t){t.$scope=e})):this.$scope}function i(){var e=Array.prototype.slice.call(arguments);t.forEach(e,function(n){var i=this.states.filter(function(t){return t.$name===n})[0],s=e.filter(function(t){return t!==i.$name});t.forEach(s,function(t){i.$exclusiveOf.push(this.states.filter(function(e){return e.$name===t})[0])}.bind(this))}.bind(this))}function s(e){function n(t){return t.$name===s}function i(t){c=this.states.filter(function(e){return e.$name===t})[0],r.$children.push(c)}var s,r,c;for(s in e)r=this.states.filter(n)[0],o.children[s].constructor===Array?t.forEach(o.children[s],i.bind(this)):i(o.children[s])}var o,r,c=0;if(!e||e.constructor!==Function)throw new TypeError("Function object must be passed into StateGroup.prototype.config");o=e();for(var u in o)if("scope"!==u&&"exclusive"!==u&&"children"!==u)throw new SyntaxError(u+" cannot be set in .config()");"scope"in o&&n.call(this,o.scope),"exclusive"in o&&o.exclusive.constructor===Array&&(t.forEach(o.exclusive,function(t){t.constructor===Array?(r="array",c++):"string"==typeof t&&(r="string")}.bind(this)),c===o.exclusive.length&&"array"===r?t.forEach(o.exclusive,function(t){i.apply(this,t)}.bind(this)):"string"===r&&i.apply(this,o.exclusive)),"children"in o&&s.call(this,o.children)}function u(){var e=[];return t.forEach(this.states,function(t){e.push(t.$model)}),e}function h(t){return t in this?this[t]:void 0}function a(e){var n={},i={},s={},o={};if(e){if(n=e,"subject"in n){if("object"!=typeof n.subject)throw new TypeError(E.constants.errors.type.ILLEGAL_SUBJECT);i=n.subject}if("model"in n){if("string"!=typeof n.model)throw new TypeError('$model must be of type "string"');if(n.model.split(".").length<3)throw new SyntaxError(E.constants.errors.syntax.ILLEGAL_MODEL_STRING);s=n.model}"event"in n&&(o=n.event)}this.isActive()&&(this.model({}),this.stop());var r=null;return this.$active=!0,this.$subject=i,this.$model=s,s.constructor!==Object&&"string"==typeof s&&(r=E.getStringModelToModel(this,this.$scope,s)),t.forEach(this.$exclusiveOf,function(t){t.isActive()&&t.stop()}),t.forEach(this.$children,function(t){t.isActive()&&t.stop()}),null!==this.$start?this.$start(this.$subject,r,o):void 0}function l(t){var e;return t?("keepSubject"in t&&(this.$subject=t.keepSubject===!0?this.$subject:{}),"event"in t&&(e=t.event)):this.$subject={},""!==this.$model&&(this.model(""),this.$model=""),this.$active===!0&&(this.$active=!1),null!==this.$stop?this.$stop(e):void 0}function f(t){var e,n=!1,i=!1,s=!0;if(t){if("keepSubject"in t){if("boolean"!=typeof t.keepSubject)throw new TypeError("keepSubject "+E.constants.errors.type.ILLEGAL_CONFIG_BOOL);n=t.keepSubject}if("stop"in t){if("boolean"!=typeof t.stop)throw new TypeError("stop "+E.constants.errors.type.ILLEGAL_CONFIG_BOOL);s=t.stop}if("keepModel"in t){if("boolean"!=typeof t.keepModel)throw new TypeError("keepModel "+E.constants.errors.type.ILLEGAL_CONFIG_BOOL);i=t.keepModel}"event"in t&&(e=t.event)}var o=E.getStringModelToModel(this,this.$scope,this.$model);return null!==this.$done&&this.$done(this.$subject,o,e),i===!1&&this.model(""),s===!0&&this.stop({keepSubject:n,event:e}),this}function p(t){if(t)this.$subject=t;else if(!t)return this.$subject}function d(t){return t||""===t?"string"==typeof this.$model&&Object.keys(this.$scope).length>0?(E.setStringModelToModel(this.$scope,this.$model,t),!0):t?void 0:!1:this.$model}function $(){return this.$active}function y(){t.forEach(arguments,function(t){if(t.constructor!==Object)t in this.$auxillary&&this.$auxillary[t].call(this,this.$subject);else if(t.constructor===Object)for(var e in t)t[e].constructor!==Array&&(t[e]=[t[e]]),t[e].unshift(this.$subject),this.$auxillary[e].apply(this,t[e])}.bind(this))}function v(e,n,i){var s,o=!1;return"string"==typeof i&&(s=i.split("."),s.shift(),t.forEach(s,function(t){o=o?o[t]:n[t]}.bind(e))),o?o:!1}function b(t,e,n){var i,s,o=t;if("string"==typeof e){if(i=e.split("."),i.shift(),i.length<2)throw new SyntaxError(E.constants.errors.syntax.ILLEGAL_MODEL_STRING);for(var r=0;r<i.length;r++)0===r&&(o[i[0]]={},s=o[i[0]]),r>0&&r<i.length-1&&(s[i[r]]={},s=s[i[r]]),r===i.length-1&&(s[i[r]]=n)}}var g=[],m={group:e,getAllGroups:n},E={getStringModelToModel:v,setStringModelToModel:b,constants:{errors:{syntax:{ILLEGAL_MODEL_STRING:"A model should be prefixed with [scope].models"},type:{ILLEGAL_SUBJECT:'A subject should be of type "object"',ILLEGAL_CONFIG_BOOL:"must contain a boolean value"}}}};return i.prototype={state:o,getAll:r,models:u,config:c},s.prototype={get:h,start:a,stop:l,done:f,subject:p,model:d,isActive:$,and:y},m}t.module("stateManager").factory("stateManager",e)}(angular);